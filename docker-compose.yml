version: '3'
#
#
# Generated by Ansible
#

services:
  zabbix-server:
    image:  yurkeen/zabbix-server-alpine
    env_file: .env
    ports:
      - "10051:10051"
#    deploy:
#      mode: replicated
#      replicas: 1
#      placement:
#        constraints:
#          - node.labels.node.type == virtual
#      restart_policy:
#        condition: on-failure
    command: "--db_host=mysql
              --db_port=3306
              --db_name=${MYSQL_DATABASE}
              --db_user=${MYSQL_USER}
              --db_password=${MYSQL_PASSWORD}"

  zabbix-web:
    image: yurkeen/zabbix-webui-alpine
    env_file: .env
    ports:
      - "80:80"
    deploy:
#      labels:
#        - traefik.port=80
#        - traefik.docker.network=traefik_front_net
#        - traefik.docker.domain=dynamic.domain.tld
#        - traefik.frontend.rule=Host:zabbix.dynamic.domain.tld
#      mode: replicated
#      replicas: 1
#      placement:
#        constraints:
#          - node.labels.node.type == virtual
#      restart_policy:
#        condition: on-failure
    command: "--zabbix_server_host=zabbix-server
              --zabbix_server_port=10051
              --db_host=mysql
              --db_port=3306
              --db_name=${MYSQL_DATABASE}
              --db_user=${MYSQL_USER}
              --db_password=${MYSQL_PASSWORD}"

  mysql:
    image: percona:latest
    env_file: .env
    volumes:
      - dbdata:/var/lib/mysql
#    deploy:
#      mode: replicated
#      replicas: 1
#      placement:
#        constraints:
#          - node.labels.node.type == virtual

volumes:
  dbdata:
   driver: local

